<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>QA Bot</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">

<style>
  :root {
    --primary: #0d9488;
    --primary-dark: #0f766e;
    --primary-light: #ccfbf1;
    --background: #f8fafc;
    --card: #ffffff;
    --text: #334155;
    --text-light: #64748b;
    --border: #e2e8f0;
    --radius-lg: 16px;
    --radius-md: 12px;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
    --transition: all 0.2s ease;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--background);
    color: var(--text);
    margin: 0;
  }

  header {
    background: var(--primary);
    color: white;
    padding: 1rem;
    text-align: center;
    font-weight: 600;
    font-size: 1.25rem;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: .5rem;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: var(--shadow-md);
  }

  main {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 1.5rem;
  }

  .container {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    flex: 1;
    min-width: 320px;
    display: flex;
    flex-direction: column;
    transition: var(--transition);
  }

  .card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .card-header {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary-dark);
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.75rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: .5rem;
  }

  textarea, input[type="text"], select {
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 0.75rem;
    font-family: inherit;
    font-size: 0.95rem;
    background: white;
    transition: var(--transition);
  }

  textarea:focus, input[type="text"]:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(13,148,136,0.15);
  }

  textarea {
    resize: vertical;
    min-height: 150px;
  }

  .btn {
    padding: 0.625rem 1.25rem;
    border-radius: var(--radius-md);
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    border: none;
  }

  .btn-primary {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-sm);
  }

  .btn-primary:hover {
    background: var(--primary-dark);
    box-shadow: var(--shadow-md);
  }

  .answer-box {
    background: var(--background);
    border-radius: var(--radius-md);
    padding: 1rem;
    min-height: 200px;
    white-space: pre-wrap;
    overflow-y: auto;
    color: var(--text);
    border: 1px solid var(--border);
  }

  .status {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-top: 0.5rem;
  }
</style>
</head>
<body>

<header>
  <i class="bi bi-robot"></i> QA Bot
</header>

<main>
  <div class="container">
    
    <!-- Input Card -->
    <section class="card">
      <div class="card-header">
        <i class="bi bi-pencil-square"></i> Ask a Question
      </div>
      <form id="qa-form" style="display:flex;flex-direction:column;gap:1rem;">
        
        <label for="model_type" style="font-weight:500;">Select Model:</label>
        <select id="model_type" name="model_type" required>
          <option value="distilbert" selected>DistilBERT (requires context)</option>
          <option value="tfidf">TF-IDF (no context needed)</option>
        </select>

        <textarea id="context" name="context" placeholder="Paste or type your context here..." required>{{ context }}</textarea>
        <input type="text" id="question" name="question" placeholder="Type your question..." value="{{ question }}" required>
        
        <button type="submit" class="btn btn-primary">
          <span class="submit-text">Get Answer</span>
          <span class="loading spinner-border" role="status" aria-hidden="true" style="display:none;"></span>
        </button>
      </form>
    </section>

    <!-- Output Card -->
    <section class="card">
      <div class="card-header">
        <i class="bi bi-chat-square-text"></i> Answer
      </div>
      <div id="answer-box" class="answer-box">
        {% if answer %}
          {{ answer }}
        {% else %}
          <span class="status">Your answer will appear here after you submit a question.</span>
        {% endif %}
      </div>
    </section>

  </div>
</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(function() {

    // Handle model change
    $('#model_type').on('change', function() {
      if ($(this).val() === 'tfidf') {
        $('#context').prop('disabled', true).val('').attr('placeholder', 'Not required for TF-IDF');
      } else {
        $('#context').prop('disabled', false).attr('placeholder', 'Paste or type your context here...');
      }
    });

    $('#qa-form').on('submit', function(e) {
      e.preventDefault();
      
      const $form = $(this);
      const $submitText = $form.find('.submit-text');
      const $loading = $form.find('.loading');
      const $answerBox = $('#answer-box');
      
      $submitText.hide();
      $loading.show();
      $answerBox.html('<div style="text-align:center;"><div class="spinner-border text-primary"></div><p>Processing your question...</p></div>');
      
      $.ajax({
        type: 'POST',
        url: '/predict',
        data: $form.serialize(),
        success: function(response) {
          $answerBox.html(`<div>${response.answer}</div>`);
        },
        error: function(xhr) {
          $answerBox.html(`<div style="color:#ef4444;">Error: ${xhr.responseJSON?.error || 'Something went wrong'}</div>`);
        },
        complete: function() {
          $loading.hide();
          $submitText.show();
        }
      });
    });
  });
</script>

</body>
</html>
